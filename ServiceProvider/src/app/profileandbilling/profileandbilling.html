<div class="profile-billing-container">
  <!-- Sidebar -->
  <app-sidebar 
    [isOpen]="isSidebarOpen" 
    (toggleSidebar)="handleSidebarToggle()">
  </app-sidebar>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Top Bar -->
    <app-topbar
      [organizerName]="organizerName"
      [location]="location"
      [userAvatar]="userAvatar"
      [notificationCount]="notificationCount"
      (searchQuery)="handleSearch($event)">
    </app-topbar>

    <!-- Profile & Billing Content -->
    <div class="profile-billing-content">
      <!-- Tabs -->
      <div class="tabs">
        <button 
          class="tab-btn" 
          [class.active]="activeTab === 'profile'"
          (click)="switchTab('profile')">
          Profile
        </button>
        <button 
          class="tab-btn" 
          [class.active]="activeTab === 'billing'"
          (click)="switchTab('billing')">
          Billing
        </button>
      </div>

      <!-- Profile Tab Content -->
      <div *ngIf="activeTab === 'profile'">
        <h2 class="section-title">Profile Settings</h2>

        <!-- Basic Information -->
        <div class="content-card">
          <h3>Basic Information</h3>
          <div class="profile-grid">
            <div class="form-group">
              <label>Business Name</label>
              <input type="text" [(ngModel)]="businessName" class="form-input" />
            </div>
            <div class="form-group">
              <label>Contact Email</label>
              <input type="email" [(ngModel)]="contactEmail" class="form-input" />
            </div>
            <div class="form-group">
              <label>Contact Phone</label>
              <input type="tel" [(ngModel)]="contactPhone" class="form-input" />
            </div>
            <div class="form-group">
              <label>Platform Description</label>
              <textarea [(ngModel)]="platformDescription" class="form-textarea" rows="3"></textarea>
            </div>
          </div>
        </div>

        <!-- Categories -->
        <div class="content-card">
          <h3>Event Categories</h3>
          <div class="categories-list">
            <label *ngFor="let category of categories" class="checkbox-label">
              <input type="checkbox" [(ngModel)]="category.selected" />
              <span>{{ category.name }}</span>
            </label>
          </div>
        </div>

        <!-- Brand Identity -->
        <div class="content-card">
          <h3>Brand Identity</h3>
          <div class="brand-identity-grid">
            <div class="form-group">
              <label>Business Logo</label>
              <div class="file-input-wrapper">
                <input type="file" id="logo" (change)="onLogoSelected($event)" accept="image/*" style="display: none;" />
                <button class="btn-file-input" onclick="document.getElementById('logo').click()">Choose File</button>
                <span class="file-name">{{ businessLogo?.name || 'No file chosen' }}</span>
              </div>
              <img *ngIf="businessLogoPreview" [src]="businessLogoPreview" class="image-preview" alt="Logo Preview" />
            </div>

            <div class="form-group">
              <label>Cover Image</label>
              <div class="file-input-wrapper">
                <input type="file" id="cover" (change)="onCoverImageSelected($event)" accept="image/*" style="display: none;" />
                <button class="btn-file-input" onclick="document.getElementById('cover').click()">Choose File</button>
                <span class="file-name">{{ coverImage?.name || 'No file chosen' }}</span>
              </div>
              <img *ngIf="coverImagePreview" [src]="coverImagePreview" class="image-preview" alt="Cover Preview" />
            </div>

            <div class="form-group">
              <label>Primary Brand Color</label>
              <div class="color-input-group">
                <input type="color" [(ngModel)]="primaryColor" class="color-picker" />
                <input type="text" [(ngModel)]="primaryColor" class="color-text" />
              </div>
            </div>

            <div class="form-group">
              <label>Secondary Brand Color</label>
              <div class="color-input-group">
                <input type="color" [(ngModel)]="secondaryColor" class="color-picker" />
                <input type="text" [(ngModel)]="secondaryColor" class="color-text" />
              </div>
            </div>
          </div>
        </div>

        <!-- Notification Preferences -->
        <div class="content-card">
          <h3>Notification Preferences</h3>
          <div class="toggle-item">
            <div class="toggle-info">
              <h4>Email Notifications</h4>
              <p>Receive email updates about your events</p>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" [(ngModel)]="emailNotifications" />
              <span class="slider"></span>
            </label>
          </div>
          <div class="toggle-item">
            <div class="toggle-info">
              <h4>RSVP Notifications</h4>
              <p>Get notified when someone RSVPs to your event</p>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" [(ngModel)]="rsvpNotifications" />
              <span class="slider"></span>
            </label>
          </div>
          <div class="toggle-item">
            <div class="toggle-info">
              <h4>Event Approval Notifications</h4>
              <p>Receive notifications for event approval status</p>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" [(ngModel)]="eventApprovalNotifications" />
              <span class="slider"></span>
            </label>
          </div>
          <div class="toggle-item">
            <div class="toggle-info">
              <h4>Weekly Reports</h4>
              <p>Get weekly analytics and performance reports</p>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" [(ngModel)]="weeklyReports" />
              <span class="slider"></span>
            </label>
          </div>
          <div class="toggle-item">
            <div class="toggle-info">
              <h4>SMS Notifications</h4>
              <p>Receive important updates via SMS</p>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" [(ngModel)]="smsNotifications" />
              <span class="slider"></span>
            </label>
          </div>
        </div>

        <!-- Account Security -->
        <div class="content-card">
          <h3>Account Security</h3>
          <div class="profile-grid">
            <div class="form-group">
              <label>Current Password</label>
              <input type="password" [(ngModel)]="currentPassword" class="form-input" />
            </div>
            <div class="form-group">
              <label>New Password</label>
              <input type="password" [(ngModel)]="newPassword" class="form-input" />
            </div>
            <div class="form-group">
              <label>Confirm New Password</label>
              <input type="password" [(ngModel)]="confirmPassword" class="form-input" />
            </div>
            <div class="form-group">
              <button class="btn-update-password" (click)="updatePassword()">Update Password</button>
            </div>
          </div>
          <div class="toggle-item">
            <div class="toggle-info">
              <h4>Two-Factor Authentication</h4>
              <p>Add an extra layer of security to your account</p>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" [(ngModel)]="twoFactorAuth" />
              <span class="slider"></span>
            </label>
          </div>
        </div>

        <!-- Social Media -->
        <div class="content-card social-media-card">
          <h3>Social Media Links</h3>
          <div class="profile-grid">
            <div class="form-group">
              <label>Instagram</label>
              <input type="text" [(ngModel)]="instagram" class="form-input" placeholder="@yourbusiness" />
            </div>
            <div class="form-group">
              <label>Facebook</label>
              <input type="text" [(ngModel)]="facebook" class="form-input" placeholder="facebook.com/yourbusiness" />
            </div>
            <div class="form-group">
              <label>TikTok</label>
              <input type="text" [(ngModel)]="tiktok" class="form-input" placeholder="@yourbusiness" />
            </div>
            <div class="form-group">
              <label>Twitter/X</label>
              <input type="text" [(ngModel)]="twitter" class="form-input" placeholder="@yourbusiness" />
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button class="btn-save" (click)="saveChanges()">Save Changes</button>
          <button class="btn-reset" (click)="resetToDefaults()">Reset to Defaults</button>
          <button class="btn-delete" (click)="deleteAccount()">Delete Account</button>
        </div>
      </div>

      <!-- Billing Tab Content -->
      <div *ngIf="activeTab === 'billing'">

        <!-- Payment Method -->
        <div class="content-card">
          <div class="card-header">
            <h3>Payment Method</h3>
          </div>
          <div class="payment-info">
            <div class="payment-method">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="2" y="5" width="20" height="14" rx="2"></rect>
                <line x1="2" y1="10" x2="22" y2="10"></line>
              </svg>
              <span>{{ paymentMethod }}</span>
            </div>
            <button class="btn-update" (click)="openPaymentMethodModal()">Update</button>
          </div>
        </div>

        <!-- Invoices -->
        <div class="content-card">
          <div class="card-header">
            <h3>Invoices</h3>
          </div>
          <div class="invoices-table">
            <div class="table-header">
              <span>Date</span>
              <span>Total</span>
              <span>Status</span>
              <span>Actions</span>
            </div>
            <div class="table-row" *ngFor="let invoice of invoices">
              <span>{{ invoice.date }}</span>
              <span>${{ invoice.total }}</span>
              <span>
                <span class="status-badge" [ngClass]="getInvoiceStatusClass(invoice.status)">
                  {{ invoice.status }}
                </span>
              </span>
              <button class="link-btn" (click)="viewInvoice(invoice.id)">View</button>
            </div>
          </div>
        </div>

        <!-- Cancel Subscription -->
        <div class="content-card">
          <div class="cancellation-section">
            <span>Cancel Subscription</span>
            <button class="btn-cancel" (click)="openCancelPlanModal()">Cancel</button>
          </div>
        </div>

        <!-- Current Plan Banner -->
        <div class="current-plan-banner">
          <span class="plan-status-badge">Active</span>
          <div class="banner-content">
            <h3>{{ currentPlan }} Plan</h3>
            <p class="plan-price">${{ getCurrentPlanPrice() }}/month</p>
            <p class="next-billing">Next billing date: {{ nextBillingDate }}</p>
            <div class="plan-features-grid">
              <div class="feature-item" *ngFor="let feature of getCurrentPlanFeatures()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                <span>{{ feature }}</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Available Plans -->
        <div class="available-plans-section">
          <h2>Available Plans</h2>
          <div class="plans-grid">
            <div 
              *ngFor="let plan of plans" 
              class="plan-card" 
              [class.current]="plan.isCurrent"
              [class.enterprise]="plan.id === 'enterprise'">
              <span *ngIf="plan.isCurrent" class="current-plan-label">Current Plan</span>
              <h3>{{ plan.name }}</h3>
              <div class="plan-price-display">
                <span class="price" *ngIf="plan.id !== 'enterprise'">${{ plan.price }}</span>
                <span class="price" *ngIf="plan.id === 'enterprise'">Custom</span>
                <span class="period">/{{ plan.period }}</span>
              </div>
              <ul class="features-list">
                <li *ngFor="let feature of plan.features">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                  <span>{{ feature }}</span>
                </li>
              </ul>
              <button 
                class="btn-plan-action"
                [class.current-plan]="plan.isCurrent"
                [class.upgrade]="!plan.isCurrent && plan.price > getCurrentPlanPrice()"
                [class.downgrade]="!plan.isCurrent && plan.price < getCurrentPlanPrice() && plan.id !== 'enterprise'"
                [class.contact]="plan.id === 'enterprise'"
                (click)="selectPlan(plan.id)"
                [disabled]="plan.isCurrent">
                <span *ngIf="plan.isCurrent">Current Plan</span>
                <span *ngIf="!plan.isCurrent && plan.id === 'enterprise'">Contact Sales</span>
                <span *ngIf="!plan.isCurrent && plan.id !== 'enterprise' && plan.price > getCurrentPlanPrice()">Upgrade</span>
                <span *ngIf="!plan.isCurrent && plan.id !== 'enterprise' && plan.price < getCurrentPlanPrice()">Downgrade</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Cancel Plan Modal -->
  <div class="modal-overlay" *ngIf="showCancelPlanModal" (click)="closeCancelPlanModal()">
    <div class="modal-container-medium" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Cancel Plan</h2>
        <button class="modal-close" (click)="closeCancelPlanModal()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="info-banner">
          <p>Cancel to stop recurring billing. You can still use the dashboard until Nov 14, 2025.</p>
        </div>
        <form class="cancel-form">
          <div class="form-group">
            <label>What is your main reason for canceling?</label>
            <select [(ngModel)]="cancelReason" name="cancelReason" class="form-select">
              <option value="">Select a reason for cancelling</option>
              <option value="security">I have security or security concerns about nipange</option>
              <option value="bugs">I kept running into errors or bugs</option>
              <option value="cost">The subscription cost is high for me</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label>Please briefly describe what led to this decision.</label>
            <textarea 
              [(ngModel)]="cancelDescription" 
              name="cancelDescription"
              class="form-textarea" 
              rows="4" 
              placeholder="Enter your reasons here"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer-split">
        <button class="btn-back" (click)="closeCancelPlanModal()">Back</button>
        <button class="btn-cancel-plan" (click)="confirmCancelPlan()">Cancel Plan</button>
      </div>
    </div>
  </div>

  <!-- Payment Method Modal -->
  <div class="modal-overlay" *ngIf="showPaymentMethodModal" (click)="closePaymentMethodModal()">
    <div class="modal-container-medium" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Payment Method</h2>
        <button class="modal-close" (click)="closePaymentMethodModal()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <form class="payment-form">
          <div class="form-group">
            <label>Full Name</label>
            <input 
              type="text" 
              [(ngModel)]="paymentForm.fullName" 
              name="fullName"
              class="form-input" 
              placeholder="Enter your full name" />
          </div>
          <div class="form-group">
            <label>Country or Region</label>
            <select [(ngModel)]="paymentForm.country" name="country" class="form-select">
              <option value="">Select your country or region</option>
              <option value="KE">Kenya</option>
              <option value="US">United States</option>
              <option value="UK">United Kingdom</option>
              <option value="CA">Canada</option>
              <option value="AU">Australia</option>
            </select>
          </div>
          <div class="form-group">
            <label>Address line 1</label>
            <input 
              type="text" 
              [(ngModel)]="paymentForm.address" 
              name="address"
              class="form-input" 
              placeholder="Enter your address" />
          </div>
          <div class="form-group">
            <label>City</label>
            <input 
              type="text" 
              [(ngModel)]="paymentForm.city" 
              name="city"
              class="form-input" 
              placeholder="Enter City" />
          </div>
          <div class="form-group">
            <label>Postal Code</label>
            <input 
              type="text" 
              [(ngModel)]="paymentForm.postalCode" 
              name="postalCode"
              class="form-input" 
              placeholder="Enter Postal Code" />
          </div>
          <div class="form-group">
            <label>Card Number</label>
            <input 
              type="text" 
              [(ngModel)]="paymentForm.cardNumber" 
              name="cardNumber"
              class="form-input" 
              placeholder="1234 1234 1234 1234"
              maxlength="19" />
          </div>
          <div class="form-row-2">
            <div class="form-group">
              <label>Expiration Date</label>
              <input 
                type="text" 
                [(ngModel)]="paymentForm.expirationDate" 
                name="expirationDate"
                class="form-input" 
                placeholder="MM/YY"
                maxlength="5" />
            </div>
            <div class="form-group">
              <label>Security Code</label>
              <input 
                type="text" 
                [(ngModel)]="paymentForm.securityCode" 
                name="securityCode"
                class="form-input" 
                placeholder="CVC"
                maxlength="4" />
            </div>
          </div>
          <div class="form-group">
            <label>Account Name</label>
            <input 
              type="text" 
              [(ngModel)]="paymentForm.accountName" 
              name="accountName"
              class="form-input" 
              placeholder="Account holder name" />
          </div>
        </form>
      </div>
      <div class="modal-footer-split">
        <button class="btn-back" (click)="closePaymentMethodModal()">Back</button>
        <button class="btn-update-payment" (click)="updatePaymentMethod()">Update</button>
      </div>
    </div>
  </div>
</div>