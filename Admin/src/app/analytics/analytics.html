<div class="dashboard-container">
  <!-- Sidebar -->
  <app-sidebar 
    [isOpen]="isSidebarOpen" 
    (toggleSidebar)="handleSidebarToggle()">
  </app-sidebar>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Top Bar -->
    <app-topbar
      [adminName]="adminName"
      [role]="role"
      [userAvatar]="userAvatar"
      (searchQuery)="handleSearch($event)">
    </app-topbar>

    <!-- Analytics & Reporting Content -->
    <div class="analytics-content">
      
      <!-- Tabs Navigation -->
      <div class="tabs-navigation">
        <button 
          class="tab-button" 
          [class.active]="activeTab === 'analytics'"
          (click)="switchTab('analytics')">
          Analytics
        </button>
        <button 
          class="tab-button" 
          [class.active]="activeTab === 'reporting'"
          (click)="switchTab('reporting')">
          Reporting
        </button>
      </div>

      <!-- Tab Content -->
      <div class="tab-content">
        
        <!-- Analytics Tab -->
        <div *ngIf="activeTab === 'analytics'" class="analytics-tab">
          
          <!-- Budget Filter Bar -->
          <div class="filter-bar">
            <div class="budget-filters">
              <span class="filter-label">Low Budget</span>
              <span class="filter-label">Mid Budget</span>
              <span class="filter-label">Luxury</span>
            </div>
            <div class="category-legend">
              <span class="legend-item" data-color="blue">Nairobi</span>
              <span class="legend-item" data-color="green">Mombasa</span>
              <span class="legend-item" data-color="yellow">Kisumu</span>
              <span class="legend-item" data-color="red">Nakuru</span>
              <span class="legend-item" data-color="purple">Other</span>
            </div>
          </div>

          <!-- Analytics Dashboard Section -->
          <div class="analytics-dashboard">
            <h2 class="dashboard-title">Analytics Dashboard</h2>
            
            <!-- Filters Row -->
            <div class="filters-row">
              <select class="filter-select" [(ngModel)]="selectedPeriod">
                <option value="30">Last 30 Days</option>
                <option value="7">Last 7 Days</option>
                <option value="90">Last 90 Days</option>
              </select>
              <select class="filter-select" [(ngModel)]="selectedCategory">
                <option value="all">All Categories</option>
                <option value="nightlife">Nightlife</option>
                <option value="sports">Sports</option>
                <option value="arts">Arts & Culture</option>
                <option value="food">Food & Dining</option>
              </select>
              <select class="filter-select" [(ngModel)]="selectedCity">
                <option value="all">All Cities</option>
                <option value="nairobi">Nairobi</option>
                <option value="mombasa">Mombasa</option>
                <option value="kisumu">Kisumu</option>
              </select>
              <button class="export-btn" (click)="exportPDF()">Export as PDF</button>
              <button class="export-btn secondary" (click)="exportCSV()">Export as CSV</button>
            </div>

            <!-- Traffic Analytics Card -->
            <div class="card">
              <h3>Traffic Analytics</h3>
              <div class="tab-buttons">
                <button 
                  class="metric-tab" 
                  [class.active]="activeMetric === 'dau'"
                  (click)="switchMetric('dau')">
                  DAU
                </button>
                <button 
                  class="metric-tab" 
                  [class.active]="activeMetric === 'wau'"
                  (click)="switchMetric('wau')">
                  WAU
                </button>
                <button 
                  class="metric-tab" 
                  [class.active]="activeMetric === 'mau'"
                  (click)="switchMetric('mau')">
                  MAU
                </button>
              </div>
              
              <!-- Metrics Grid -->
              <div class="metrics-grid">
                <div class="metric-card">
                  <div class="metric-icon-label">
                    <div class="metric-label">Daily Active Users</div>
                    <svg class="metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M9 19v-6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2zm0 0V9a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v10m-6 0a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2m0 0V5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-2a2 2 0 0 0-2-2z"/>
                    </svg>
                  </div>
                  <div class="metric-value">{{dailyActiveUsers}}</div>
                  <div class="metric-change positive">+8.5% vs yesterday</div>
                </div>
                <div class="metric-card">
                  <div class="metric-icon-label">
                    <div class="metric-label">Peak Usage Time</div>
                    <svg class="metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M9 19v-6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2zm0 0V9a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v10m-6 0a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2m0 0V5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-2a2 2 0 0 0-2-2z"/>
                    </svg>
                  </div>
                  <div class="metric-value">6 - 9 PM</div>
                  <div class="metric-subtext">Weekend evenings</div>
                </div>
                <div class="metric-card">
                  <div class="metric-icon-label">
                    <div class="metric-label">Top Location</div>
                    <svg class="metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M9 19v-6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2zm0 0V9a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v10m-6 0a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2m0 0V5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-2a2 2 0 0 0-2-2z"/>
                    </svg>
                  </div>
                  <div class="metric-value">Nairobi</div>
                  <div class="metric-subtext">68% of all users</div>
                </div>
              </div>

              <div class="metrics-grid second-row">
                <div class="metric-card">
                  <div class="metric-icon-label">
                    <div class="metric-label">AVG Booking Value</div>
                    <svg class="metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M9 19v-6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2zm0 0V9a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v10m-6 0a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2m0 0V5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-2a2 2 0 0 0-2-2z"/>
                    </svg>
                  </div>
                  <div class="metric-value">KSH 2,500</div>
                  <div class="metric-change positive">+15% increase</div>
                </div>
                <div class="metric-card">
                  <div class="metric-icon-label">
                    <div class="metric-label">Page Views</div>
                    <svg class="metric-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M9 19v-6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2zm0 0V9a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v10m-6 0a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2m0 0V5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-2a2 2 0 0 0-2-2z"/>
                    </svg>
                  </div>
                  <div class="metric-value">45,678</div>
                  <div class="metric-change negative">-3% vs last period</div>
                </div>
              </div>
            </div>

            <!-- Charts Grid -->
            <div class="charts-grid">
              <!-- Engagement by Category -->
              <div class="card">
                <h3>Engagement by Category</h3>
                <div class="chart-container">
                  <canvas id="engagementByCategoryChart"></canvas>
                </div>
              </div>

              <!-- User Demographics by Age -->
              <div class="card">
                <h3>User Demographics by Age</h3>
                <div class="chart-container">
                  <canvas id="userDemographicsChart"></canvas>
                </div>
              </div>

              <!-- Mood-based Event Participation -->
              <div class="card">
                <h3>Mood-based Event Participation</h3>
                <div class="chart-container">
                  <canvas id="moodBasedChart"></canvas>
                </div>
              </div>

              <!-- User Conversion Funnel -->
              <div class="card">
                <h3>User Conversion Funnel</h3>
                <div class="chart-container">
                  <canvas id="conversionFunnelChart"></canvas>
                </div>
              </div>

              <!-- Revenue Analytics -->
              <div class="card">
                <h3>Revenue Analytics</h3>
                <div class="chart-container">
                  <canvas id="revenueAnalyticsChart"></canvas>
                </div>
              </div>

              <!-- Hourly Engagement Patterns -->
              <div class="card">
                <h3>Hourly Engagement Patterns</h3>
                <div class="chart-container">
                  <canvas id="hourlyEngagementChart"></canvas>
                </div>
              </div>
            </div>

            <!-- Top Lists Grid -->
            <div class="top-lists-grid">
              <!-- Top Events -->
              <div class="card">
                <h3>Top Events</h3>
                <div class="event-list">
                  <div class="event-item" *ngFor="let event of topEvents">
                    <div class="event-info">
                      <div class="event-title">{{event.title}}</div>
                      <div class="event-subtitle">{{event.subtitle}}</div>
                    </div>
                    <div class="event-count">{{event.count}}</div>
                  </div>
                </div>
              </div>

              <!-- Top Organizers -->
              <div class="card">
                <h3>Top Organizers</h3>
                <div class="organizer-list">
                  <div class="organizer-item" *ngFor="let organizer of topOrganizers">
                    <div class="organizer-avatar">{{organizer.initials}}</div>
                    <div class="organizer-info">
                      <div class="organizer-name">{{organizer.name}}</div>
                      <div class="organizer-events">{{organizer.eventsCount}} events created</div>
                    </div>
                    <div class="organizer-score">
                      <div class="score-bar" [style.width.%]="organizer.score"></div>
                      <span>{{organizer.score}}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>

        <!-- Reporting Tab -->
        <div *ngIf="activeTab === 'reporting'" class="reporting-tab">
          
          <!-- Reporting Header -->
          <div class="reporting-header">
            <div>
              <h2 class="section-title">Reports & Data Export</h2>
              <p class="section-subtitle">Generate comprehensive reports and insights</p>
            </div>
            <div class="reporting-actions">
              <button class="btn-outline" (click)="viewScheduledReports()">
                Scheduled Reports ({{scheduledReportsCount}})
              </button>
              <button class="btn-primary" (click)="createCustomReport()">
                + Create Custom Report
              </button>
            </div>
          </div>

          <!-- Report Tabs -->
          <div class="report-tabs">
            <button 
              class="report-tab" 
              [class.active]="activeReportTab === 'standard'"
              (click)="switchReportTab('standard')">
              Standard Reports
            </button>
            <button 
              class="report-tab" 
              [class.active]="activeReportTab === 'custom'"
              (click)="switchReportTab('custom')">
              Custom Report Builder
            </button>
            <button 
              class="report-tab" 
              [class.active]="activeReportTab === 'saved'"
              (click)="switchReportTab('saved')">
              Saved Templates ({{savedTemplatesCount}})
            </button>
          </div>

          <!-- Standard Reports -->
          <div *ngIf="activeReportTab === 'standard'" class="report-tab-content">
            <div class="report-categories">
              <div 
                class="category-card" 
                [class.active]="selectedReportCategory === 'user'"
                (click)="selectReportCategory('user')">
                <div class="category-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                  </svg>
                </div>
                <div class="category-info">
                  <h4>User Reports</h4>
                  <p>4 Reports</p>
                </div>
              </div>
              
              <div 
                class="category-card"
                [class.active]="selectedReportCategory === 'event'"
                (click)="selectReportCategory('event')">
                <div class="category-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                  </svg>
                </div>
                <div class="category-info">
                  <h4>Event Reports</h4>
                  <p>4 Reports</p>
                </div>
              </div>
              
              <div 
                class="category-card"
                [class.active]="selectedReportCategory === 'financial'"
                (click)="selectReportCategory('financial')">
                <div class="category-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="1" x2="12" y2="23"></line>
                    <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                  </svg>
                </div>
                <div class="category-info">
                  <h4>Financial Reports</h4>
                  <p>4 Reports</p>
                </div>
              </div>
              
              <div 
                class="category-card"
                [class.active]="selectedReportCategory === 'compliance'"
                (click)="selectReportCategory('compliance')">
                <div class="category-icon">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                  </svg>
                </div>
                <div class="category-info">
                  <h4>Compliance Reports</h4>
                  <p>4 Reports</p>
                </div>
              </div>
            </div>

            <div *ngIf="selectedReportCategory" class="selected-category-reports">
              <div class="category-header">
                <h3>{{getSelectedCategoryName()}}</h3>
                <button class="btn-outline" (click)="selectedReportCategory = null">
                  Back to Categories
                </button>
              </div>

              <div class="reports-list">
                <div class="report-item" *ngFor="let report of getSelectedCategoryReports()">
                  <div class="report-info">
                    <h4>{{report.title}}</h4>
                    <p>{{report.description}}</p>
                    <span class="report-timestamp">Last run: {{report.lastRun}}</span>
                  </div>
                  <div class="report-actions">
                    <button class="btn-icon-simple" title="Schedule">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                      </svg>
                    </button>
                    <div class="export-dropdown-wrapper">
                      <button class="btn-export-action" (click)="toggleExportMenu(report.id)">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                          <polyline points="7 10 12 15 17 10"></polyline>
                          <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        Export
                      </button>
                      <div class="export-menu-overlay" *ngIf="activeExportMenu === report.id" (click)="toggleExportMenu(report.id)"></div>
                      <div class="export-menu" *ngIf="activeExportMenu === report.id">
                        <button class="export-menu-option" (click)="exportReportAs(report.id, 'csv')">
                          <svg class="export-menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="20" x2="12" y2="10"></line>
                            <line x1="18" y1="20" x2="18" y2="4"></line>
                            <line x1="6" y1="20" x2="6" y2="16"></line>
                          </svg>
                          <div class="export-menu-text">
                            <div class="export-menu-title">CSV</div>
                            <div class="export-menu-desc">For Excel/Google Sheets</div>
                          </div>
                        </button>
                        <button class="export-menu-option" (click)="exportReportAs(report.id, 'pdf')">
                          <svg class="export-menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                          </svg>
                          <div class="export-menu-text">
                            <div class="export-menu-title">PDF</div>
                            <div class="export-menu-desc">Formal reports & presentations</div>
                          </div>
                        </button>
                        <button class="export-menu-option" (click)="exportReportAs(report.id, 'xlsx')">
                          <svg class="export-menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"></rect>
                            <rect x="14" y="3" width="7" height="7"></rect>
                            <rect x="14" y="14" width="7" height="7"></rect>
                            <rect x="3" y="14" width="7" height="7"></rect>
                          </svg>
                          <div class="export-menu-text">
                            <div class="export-menu-title">Excel (.xlsx)</div>
                            <div class="export-menu-desc">Multi-sheet reports & charts</div>
                          </div>
                        </button>
                        <button class="export-menu-option" (click)="exportReportAs(report.id, 'json')">
                          <svg class="export-menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="16 18 22 12 16 6"></polyline>
                            <polyline points="8 6 2 12 8 18"></polyline>
                          </svg>
                          <div class="export-menu-text">
                            <div class="export-menu-title">JSON</div>
                            <div class="export-menu-desc">API Consumers & integrations</div>
                          </div>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Custom Report Builder -->
          <div *ngIf="activeReportTab === 'custom'" class="report-tab-content">
            <div class="report-builder">
              <h3>Build Your Custom Report</h3>
              
              <div class="form-group">
                <label>Data Source</label>
                <select class="form-select" [(ngModel)]="customReport.dataSource" (change)="onDataSourceChange()">
                  <option value="">Select a data source</option>
                  <option value="user">User Data</option>
                  <option value="event">Event Data</option>
                  <option value="financial">Financial Transactions</option>
                  <option value="compliance">Compliance Logs</option>
                </select>
              </div>

              <div class="form-group" *ngIf="customReport.dataSource">
                <label>Select Fields to Include * ({{customReport.selectedFields.length}} selected)</label>
                <div class="field-grid">
                  <div class="field-checkbox" *ngFor="let field of getAvailableFields()">
                    <input 
                      type="checkbox" 
                      [id]="field" 
                      [value]="field"
                      [checked]="customReport.selectedFields.includes(field)"
                      (change)="toggleField(field)">
                    <label [for]="field">{{field}}</label>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <div class="section-header-inline">
                  <label>Filters</label>
                  <button class="btn-link" (click)="addFilter()">Add Filter</button>
                </div>
                <div class="filter-row" *ngFor="let filter of customReport.filters; let i = index">
                  <select class="form-select" [(ngModel)]="filter.field">
                    <option value="">Select field</option>
                    <option *ngFor="let field of getAvailableFields()" [value]="field">{{field}}</option>
                  </select>
                  <select class="form-select" [(ngModel)]="filter.operator">
                    <option value="equals">Equals</option>
                    <option value="notEquals">Not equals</option>
                    <option value="contains">Contains</option>
                    <option value="greaterThan">Greater than</option>
                    <option value="lessThan">Less than</option>
                  </select>
                  <input type="text" class="form-input" placeholder="Value" [(ngModel)]="filter.value">
                  <button class="btn-remove" *ngIf="customReport.filters.length > 1" (click)="removeFilter(i)">Remove</button>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>Date From</label>
                  <input type="date" class="form-input" [(ngModel)]="customReport.dateFrom">
                </div>
                <div class="form-group">
                  <label>Date To</label>
                  <input type="date" class="form-input" [(ngModel)]="customReport.dateTo">
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label>Group By</label>
                  <select class="form-select" [(ngModel)]="customReport.groupBy">
                    <option value="none">None</option>
                    <option value="date">Date</option>
                    <option value="category">Category</option>
                    <option value="location">Location</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Sort By</label>
                  <select class="form-select" [(ngModel)]="customReport.sortBy">
                    <option value="newest">Registration Date (Newest)</option>
                    <option value="oldest">Registration Date (Oldest)</option>
                    <option value="asc">Name (A-Z)</option>
                    <option value="desc">Name (Z-A)</option>
                  </select>
                </div>
              </div>

              <div class="form-actions">
                <button class="btn-outline" (click)="saveAsTemplate()">Save as a Template</button>
                <button class="btn-outline" (click)="scheduleCustomReport()">Schedule</button>
                <button class="btn-outline" (click)="previewReport()">Preview</button>
                <button class="btn-primary" (click)="generateReport()">Generate Report</button>
              </div>
            </div>
          </div>

          <!-- Saved Templates -->
          <div *ngIf="activeReportTab === 'saved'" class="report-tab-content">
            <div class="templates-header">
              <h3>Saved Report Templates</h3>
              <p>Reuse your custom report configurations</p>
            </div>

            <div class="template-list">
              <div class="template-item" *ngFor="let template of savedTemplates">
                <div class="template-info">
                  <h4>{{template.name}}</h4>
                  <div class="template-meta">
                    <span>{{template.category}}</span>
                    <span>â€¢ {{template.fieldsSelected}} fields selected</span>
                  </div>
                </div>
                <div class="template-actions">
                  <button class="btn-icon-simple" title="Share" (click)="shareTemplate(template.id)">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                      <circle cx="18" cy="5" r="3"></circle>
                      <circle cx="6" cy="12" r="3"></circle>
                      <circle cx="18" cy="19" r="3"></circle>
                      <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                      <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                    </svg>
                  </button>
                  <button class="btn-icon-simple delete-icon" title="Delete" (click)="deleteTemplate(template.id)">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                      <path d="M3 6h18M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2m3 0v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6h14z"></path>
                      <line x1="10" y1="11" x2="10" y2="17"></line>
                      <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                  </button>
                  <button class="btn-use-template" (click)="useTemplate(template.id)">Use Template</button>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </main>
</div>