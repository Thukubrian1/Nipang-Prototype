<div class="dashboard-container">
  <!-- Sidebar -->
  <app-sidebar 
    [isOpen]="isSidebarOpen" 
    (toggleSidebar)="handleSidebarToggle()">
  </app-sidebar>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Top Bar -->
    <app-topbar
      [adminName]="adminName"
      [role]="role"
      [userAvatar]="userAvatar"
      (searchQuery)="handleSearch($event)">
    </app-topbar>

    <!-- Messaging Center Content -->
    <div class="messaging-content">
      
      <!-- Tabs Navigation -->
      <div class="tabs-navigation">
        <button 
          class="tab-button" 
          [class.active]="activeTab === 'summary'"
          (click)="switchTab('summary')">
          Notifications Summary
        </button>
        <button 
          class="tab-button" 
          [class.active]="activeTab === 'sent'"
          (click)="switchTab('sent')">
          Sent Notifications
        </button>
        <button 
          class="tab-button" 
          [class.active]="activeTab === 'templates'"
          (click)="switchTab('templates')">
          Message Templates
        </button>

        <!-- Search Bar (position varies by tab) -->
        <div class="tab-search" *ngIf="activeTab === 'summary'">
          <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          <select class="search-dropdown" [(ngModel)]="summarySearchBy">
            <option value="title">Title</option>
            <option value="status">Status</option>
            <option value="target">Target</option>
          </select>
          <input 
            type="text" 
            placeholder="Search by title, status..." 
            class="search-input"
            [(ngModel)]="summarySearchQuery">
        </div>

        <div class="tab-search" *ngIf="activeTab === 'sent'">
          <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          <select class="search-dropdown" [(ngModel)]="sentSearchBy">
            <option value="title">Title</option>
            <option value="status">Status</option>
            <option value="receiver">Receiver</option>
          </select>
          <input 
            type="text" 
            placeholder="Search by title, status..." 
            class="search-input"
            [(ngModel)]="sentSearchQuery">
        </div>

        <div class="tab-search" *ngIf="activeTab === 'templates'">
          <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          <select class="search-dropdown" [(ngModel)]="templateSearchBy">
            <option value="name">Template Name</option>
            <option value="type">Type</option>
            <option value="status">Status</option>
          </select>
          <input 
            type="text" 
            placeholder="Search by name, type..." 
            class="search-input"
            [(ngModel)]="templateSearchQuery">
        </div>
      </div>

      <!-- Tab Content -->
      <div class="tab-content">
        
        <!-- Notifications Summary Tab -->
        <div *ngIf="activeTab === 'summary'" class="summary-tab">
          <div class="section-header">
            <div>
              <h2 class="section-title">Push Notifications</h2>
              <p class="section-subtitle">Send targeted notifications to users and providers</p>
            </div>
            <button class="btn-primary" (click)="sendNotification()">Send Notification</button>
          </div>

          <!-- Stats Cards -->
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-header">
                <h3>Sent Today</h3>
                <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                  <line x1="16" y1="2" x2="16" y2="6"></line>
                  <line x1="8" y1="2" x2="8" y2="6"></line>
                  <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
              </div>
              <div class="stat-value">{{sentToday}}</div>
              <div class="stat-footer positive">+{{sentTodayChange}}% vs yesterday</div>
            </div>

            <div class="stat-card">
              <div class="stat-header">
                <h3>Open Rate</h3>
                <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                  <line x1="16" y1="2" x2="16" y2="6"></line>
                  <line x1="8" y1="2" x2="8" y2="6"></line>
                  <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
              </div>
              <div class="stat-value">{{openRate}}%</div>
              <div class="stat-footer positive">+{{openRateChange}}% vs last week</div>
            </div>

            <div class="stat-card">
              <div class="stat-header">
                <h3>Click Rate</h3>
                <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                  <line x1="16" y1="2" x2="16" y2="6"></line>
                  <line x1="8" y1="2" x2="8" y2="6"></line>
                  <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
              </div>
              <div class="stat-value">{{clickRate}}%</div>
              <div class="stat-footer positive">+{{clickRateChange}}% vs last month</div>
            </div>
          </div>

          <!-- Notifications Table -->
          <div class="data-table">
            <table>
              <thead>
                <tr>
                  <th>Title</th>
                  <th>Target</th>
                  <th>Sent</th>
                  <th>Opens</th>
                  <th>Status</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let notification of notifications">
                  <td>{{notification.title}}</td>
                  <td>{{notification.target}}</td>
                  <td>{{notification.sent | number:'1.0-0'}}</td>
                  <td>{{notification.opens | number:'1.0-0'}}</td>
                  <td>
                    <span class="status-badge" [class.delivered]="notification.status === 'Delivered'" [class.pending]="notification.status === 'Pending'">
                      {{notification.status}}
                    </span>
                  </td>
                  <td class="actions-cell">
                    <button *ngIf="notification.status === 'Pending'" class="btn-text" (click)="editNotification(notification.id)">Edit</button>
                    <button *ngIf="notification.status === 'Pending'" class="btn-text delete" (click)="deleteNotification(notification.id)">Delete</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Sent Notifications Tab -->
        <div *ngIf="activeTab === 'sent'" class="sent-tab">
          <div class="data-table">
            <table>
              <thead>
                <tr>
                  <th>Title</th>
                  <th>Sender</th>
                  <th>Receiver</th>
                  <th>Message</th>
                  <th>Attachment</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let sent of sentNotifications">
                  <td>{{sent.title}}</td>
                  <td>{{sent.sender}}</td>
                  <td>{{sent.receiver}}</td>
                  <td class="message-cell">{{sent.message}}</td>
                  <td class="attachment-cell">{{sent.attachment}}</td>
                  <td>
                    <span class="status-badge" [class.delivered]="sent.status === 'Delivered'" [class.pending]="sent.status === 'Pending'">
                      {{sent.status}}
                    </span>
                  </td>
                  <td class="actions-cell">
                    <button class="btn-text" (click)="editSent(sent.id)">Edit</button>
                    <button class="btn-text" (click)="resendNotification(sent.id)">Resend</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Pagination -->
          <div class="pagination">
            <button class="page-btn" (click)="previousPage()" [disabled]="currentPage === 1">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 18 9 12 15 6"></polyline>
              </svg>
            </button>
            <button class="page-btn" (click)="goToFirstPage()" [disabled]="currentPage === 1">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="11 17 6 12 11 7"></polyline>
                <polyline points="18 17 13 12 18 7"></polyline>
              </svg>
            </button>
            <button 
              *ngFor="let page of visiblePages" 
              class="page-number" 
              [class.active]="page === currentPage"
              (click)="goToPage(page)">
              {{page}}
            </button>
            <button class="page-btn" (click)="goToLastPage()" [disabled]="currentPage === totalPages">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="13 17 18 12 13 7"></polyline>
                <polyline points="6 17 11 12 6 7"></polyline>
              </svg>
            </button>
            <button class="page-btn" (click)="nextPage()" [disabled]="currentPage === totalPages">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </button>
          </div>
        </div>

        <!-- Message Templates Tab -->
        <div *ngIf="activeTab === 'templates'" class="templates-tab">
          <div class="section-header">
            <div>
              <h2 class="section-title">Message Templates</h2>
              <p class="section-subtitle">Manage your message templates for notifications, emails, and communications</p>
            </div>
            <button class="btn-primary" (click)="addTemplate()">Add Template</button>
          </div>

          <!-- Stats Cards -->
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-header">
                <h3>Total Messages</h3>
                <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                  <line x1="16" y1="2" x2="16" y2="6"></line>
                  <line x1="8" y1="2" x2="8" y2="6"></line>
                  <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
              </div>
              <div class="stat-value">{{totalMessages}}</div>
            </div>

            <div class="stat-card">
              <div class="stat-header">
                <h3>Active</h3>
                <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                  <line x1="16" y1="2" x2="16" y2="6"></line>
                  <line x1="8" y1="2" x2="8" y2="6"></line>
                  <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
              </div>
              <div class="stat-value">{{activeMessages}}</div>
            </div>

            <div class="stat-card">
              <div class="stat-header">
                <h3>Inactive</h3>
                <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                  <line x1="16" y1="2" x2="16" y2="6"></line>
                  <line x1="8" y1="2" x2="8" y2="6"></line>
                  <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
              </div>
              <div class="stat-value">{{inactiveMessages}}</div>
            </div>
          </div>

          <!-- Templates Table -->
          <div class="data-table">
            <table>
              <thead>
                <tr>
                  <th>Template Name</th>
                  <th>Template Type</th>
                  <th>Subject Line</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let template of templates">
                  <td>{{template.name}}</td>
                  <td>{{template.type}}</td>
                  <td class="subject-cell">{{template.subject}}</td>
                  <td>
                    <span class="status-badge" [class.active]="template.status === 'Active'" [class.inactive]="template.status === 'Inactive'">
                      {{template.status}}
                    </span>
                  </td>
                  <td class="actions-cell">
                    <button class="btn-text" (click)="editTemplate(template.id)">Edit</button>
                    <button class="btn-text delete" (click)="deleteTemplate(template.id)">Delete</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

      </div>
    </div>
  </main>
</div>